---
title: "Tenka1 Programmer Contest 2019 E問題考察"
date: 2019-05-02T10:32:18+09:00
archives: "2019"
tags: [競技プログラミング, AtCoder]
---

[以前の記事](https://hee-san.github.io/blog/2019/tenka1_programmer_contest_2019_%E5%8F%82%E5%8A%A0%E8%A8%98%E9%8C%B2/)で、Tenka1 Programmer Contest 2019のC・D問題を解きました。

今回はE問題の考察をしたいと思います。

<!--more-->

> ### E - Polynomial Divisors
>
> ##### 問題文
>
> $N$次の整数係数多項式$f(x)=a_Nx^N+a\_{N-1}x^{N-1}+...+a_0$が与えられます。
>
> 任意の整数$x$に対して$p$が$f(x)$を割り切るような素数$p$をすべて求めてください。
>
> ##### 制約
> - $0 \leq N \leq 10^4$
> - $|a_i| \leq 10^9(0\leq i\leq N)$
> - $a_N \neq 0$
> - 入力はすべて整数である
>
> <cite>[E - Polynomial Divisors](https://atcoder.jp/contests/tenka1-2019/tasks/tenka1_2019_e)</cite>

$p$が$f(x)$を割り切るとは、$f(x)\equiv 0 \pmod{p}$ということです。

---

このような指数関数で、素数を法とする剰余に関するものには、`フェルマーの小定理`が使えそうだなと考えられます。
この定理を知っている人であれば、問題文を見た瞬間に、これを使うと予想を立てるでしょう。
それくらい頻繁に利用される、便利な定理です。

> ##### フェルマーの小定理
> 素数$p$と、$p$の倍数でない任意の整数$a$について、以下が成り立つ。
> $$a^{p-1} \equiv 1 \pmod{p}$$

たとえば、
$$3^{6} = 729 \equiv 1 \pmod{7}$$
$$12^{4} = 20736 \equiv 1 \pmod{5}$$
など、成り立つことが確認できます。

フェルマーの小定理より、$f(x)$は次のように変形できます。

\begin{align}
f(x) &= a_0 \\\\\\
&\quad+ (a\_{1}+a\_{p}+a\_{2p-1}+...)x \\\\\\
&\quad+ (a\_{2}+a\_{p+1}+a\_{2p}+...)x^2 \\\\\\
&\quad+ ... \\\\\\
&\quad+ (a\_{p-2}+a\_{2p-3}+a\_{3p-4}+...)x^{p-2} \\\\\\
&\quad+ (a\_{p-1}+a\_{2p-2}+a\_{3p-3}+...)x^{p-1} \\\\\\
&= b\_{p-1}x^{p-1}+b\_{p-2}x^{p-2}+...+b_0
\end{align}

定数項を$(a_0+a\_{p-1}+a\_{2p-2}+a\_{3p-3}+...)$とまとめたくなりますが、$f(0)$を考えると、それは間違いであることがわかります。

こうすることで、$N$次だった$f(x)$を、$p-1$次まで抑えることができました。

---

つぎに、$f(x)\equiv 0$の条件を考えます。

たとえば**各$b_i$の剰余が、すべて$0$である場合**、$f(x)$の剰余も$0$となります。
これは簡単に判定できます。

もう1つの場合として、**各$b_i$の剰余は$0$でなくとも、$f(x)\equiv 0$になる場合**が想像できます。この場合は各項を独立して考えることはできないので、実装が難しそうです。
しかし、**このような場合は存在しない**と、数学的に証明できます。

証明には`剰余の定理`を用います。

> ##### 剰余の定理
> $f(x)$を$x-a$で割った余りは、$f(a)$に等しい。

ここから`因数定理`などが導かれます。

> ##### 因数定理
> $f(a) = 0$ ならば、$f(x)$は$x-a$を因数に持つ。

今回は$f(0) \equiv f(1) \equiv ... \equiv f(p-1) \equiv 0 \pmod{p}$がわかっています。
これは等式でなく合同式なので、因数定理を直接使うことはできません。

剰余の定理から、つぎのことが言えます。

> $N$次整数多項式$f(x)$について、$f(a)\equiv 0 \pmod{p}$ならば、
> $$f(x) = (x-a)g(x) + kp$$
> と表せる。ただし、$g(x)$は$N-1$次整数多項式、$k$は整数。

この式で$a=0$とすると、次の等式が得られます。
$$f(x) = xg(x) + k_0p$$

つぎに、この式で$x=1$とすると、$f(1)\equiv g(1)\equiv 0$なので、次の等式が得られます。
$$g(x) = (x-1)h(x) + k_1p$$

よって、
$$f(x) = x(x-1)h(x)+ k_1px + k_0p$$
が示されます。

これを繰り返すことで、
\begin{align}
f(x) &= cx(x-1)(x-2)...(x-(p-1)) \\\\\\
&\quad+ p(k_0+k_1x+...+k\_{p-1}x^{p-1})
\end{align}
が得られます。（係数$c$は定数。）

ここで係数$c$を持つ第一項は、$p$次の項です。
$f(x)$は$p-1$次で表現できるため、$c=0$であると言えます。

よって、次の等式が成り立ちます。
$$f(x) = pk_0+pk_1x+...+pk\_{p-1}x^{p-1}$$
これは言い換えると、
$$b_i=pk_i$$
$$b_i \equiv 0 \pmod{p}$$
ということです。

よって、**各$b_i$の剰余が、すべて$0$である**ことが証明できました。

（公式解説の[pdf](https://img.atcoder.jp/tenka1-2019/editorial.pdf)や[YouTube](https://youtu.be/uQvc7k2xamY)では、簡潔に証明しています。自分はそれの正しさがわからなかったので、丁寧に証明してみました。）

---

最後に、素数$p$の探索範囲を絞ります。

$f(0)\equiv 0 \pmod{p}$より、$p$は$f(0)$の素因数です。

よって$p$の候補は、$a_i$の総和を素因数分解することで得られます。

---

解法をまとめると、次のようになります。

1. $a_i$の総和を素因数分解し、$p$の候補を得る。
1. 各$p$に対し、$b_i$を求める。
1. $b_i$の剰余がすべて$0$であれば、$p$を出力する。


---

こうして丁寧に考えると、やはりE問題は難しいなと感じました。
しかし本番では厳密な証明は不要なので、次に同じような問題が出れば、すぐに解けます。
問題をたくさん解いたり、数学の定理等を覚えたりすることで引き出しを増やしておくことが大切だと感じました。
