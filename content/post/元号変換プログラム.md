---
title: "元号変換プログラム"
date: 2019-04-19T11:10:44+09:00
archives: "2019/04"
tags: [python]
---
Python・TDDで、年の西暦表記・元号表記を相互に変換するようなプログラムを作成します。
<!--more-->
## テスト書いていますか？
いきなり元号と関係のない話なんですが。

身の回りでテストコードをちゃんと書いている友人がいません。
悲しいです。書きましょう。

僕は、テストには以下のようなメリットがあると思います。

* 動作が保証されること
* サンプルとして、使い方が簡単にわかること

同期の友人は研究室へ入るこの機に、ぜひテストやドキュメントを書く習慣をつけてほしいです。

この記事ではさらに踏み込んで、**TDD（テスト駆動開発）**を行います。

これは、メインプログラムより先にテストコードを書いちゃう開発手法です。

先に目標の動作を明記するので、開発する上で目標を見失うこともないです。

他にもメリットがたくさんあるんですが、それはまたの機会に書こうと思います。

## 開発環境
**Python**を使います。（今回の例では）簡潔なコードで済み、テストの用意が簡単だから選びました。

初めのうちは、外部ライブラリ等は利用しない予定です。

テストには、標準ライブラリの**doctest**を使います。

## 2020年は令和2年
何はともあれ、まずはテストを書きます。

**はじめに、「西暦を令和に変換できる」という仕様を満たしたいです。**
「1年は元年とする」や「昭和・平成にも変換可能にする」等は後回しです。

<script src="https://gist.github.com/Hee-San/9a9ddc82851182e2d2f712e0d4429d6a/627b1e9ebe4d50f2f64223171b8150cf2f64a50a.js"></script>

``ad2ja``という関数を作りました。
これを、西暦を整数で受け取り、元号表記をprintする関数にします。

関数の中身は、コメント文と``pass``文のみです。

``pass``文とは、「何もしない関数」なので、この``ad2ja``関数も、何もしない関数です。


さて、今回は以下のようなコメント文を書きました。

```
"""
>>> ad2ja(2020)
令和2年
"""
```

これが今回目標とする仕様の、最初のテストケースです。
数値``2020``を入力引数として受け取ると、``令和2年``と表示します。

doctestを用いると、上の例のように、``doctest.testmod()``を実行するだけですべてのテストを実行してくれます。
簡単にテストを実装できるのでオススメです。


出力実行結果を見ると、最後にテスト結果が出力されています。
```
TestResults(failed=1, attempted=1)
```
これは実行したテスト（attempted）が1つあり、そのうち1つのテストが失敗（failed）したという表示です。

その上には、失敗したテストの詳細が表示されています。

```
**********************************************************************
File "__main__", line 3, in __main__.ad2ja
Failed example:
    ad2ja(2020)
Expected:
    令和2年
Got nothing
**********************************************************************
```
``令和2年``という出力を期待していたのに、何も出力されなかった（Got nothing）と表示されています。

``pass``しかない関数なので当然の結果でしょう。

このように、先にテストを書くのが**TDD**です。

---

それでは、このテストが通るようにプログラムを書いていきましょう。

<script src="https://gist.github.com/Hee-San/9a9ddc82851182e2d2f712e0d4429d6a/8b7997180771ea821a482907dc26558b3a703960.js"></script>

``pass``を消し、``print('令和2年')``と追加することでテストが通りました。
faild=0になったので、詳細結果の表示は省かれています。

そんな実装で大丈夫か？と思われるかもしませんが、大丈夫です。問題ありません。

テストを通すことが目標です。要求されていないことまで実装すると、コードのムダな肥大化に繋がります。

追加機能が必要なら、そのたびにテストを先に書く。これがTDDです。

まあ今回は説明のためですので、実際はここまでくどく行う必要はないでしょう。保守などのコストはテストによって削減できますが、テスト実装にもコストは掛かります。チームやプロジェクトに合わせて、程よく使ってください。

---

更新が遅くなりそうなので、今回はここまでにします。
1週間以内には次回分も書こうと思っています。

次回はちゃんと、元号変換していきたいと思います。

