---
title: "AGC034 C問題"
date: 2019-06-05T21:43:43+09:00
archives: ["2019/06"]
tags: [競技プログラミング, AtCoder]
---

先日（2019/06/02）、AtCoderで開催された[AtCoder Grand Contest 034](https://atcoder.jp/contests/agc034)に参加しました。
久々のブログ更新です。

<!--more-->

前回からかなり時間が開いてしまいました。

研究が忙しくなっていたためです。
現在も十分忙しいのですが、実験終了の待ち時間に余裕が出てきたため、久々に投稿してみようと思いました。

![レートグラフ](/blog/img/AGC034.png)

忙しい間もコンテスト参加は欠かさなかったので、レートは少しずつ上ってきています。

精進できていない（過去問を解くなどの努力ができていない）ため、伸び率は低いですが、次の青色が見えるようになってきたのはとても嬉しことです。

少し書かないうちに文章力が落ちてしまった気がしますが、C問題の考察に入っていきたいと思います。

---

> ### C - Tests
> (800点)
>
> ##### 問題文
>
> 高橋くんと青木くんは$1$から$N$までの番号がついたテストを受けようとしています。
> 二人はこのテストの結果を使って勝負することにしました。
> 具体的には、次のようにして勝敗を決めます。
>
> - 高橋くんが各テスト$i$について、その重要度$c\_i$を決める。
> ただしこの値は$l\_i$以上$u\_i$以下の整数である必要がある。
> - $\sum\_{i=1}^{N} c\_i \times$(高橋くんのテスト$i$の点数)$\ $を$A$、$\sum\_{i=1}^{N} c\_i \times$(青木くんのテスト$i$の点数)$\ $を$B$とする。
> $A \geq B$なら高橋くんの勝ち、$A<B$なら青木くんの勝ち。
>
> 高橋くんはエスパーなので、青木くんがテスト$i$で$b\_i$点をとることがわかっています。
>
> 高橋くんはこのままだとすべてのテストで$0$点をとってしまいますが、1時間勉強するごとに、好きなテストの点数を1だけ上げることができます。
> (1時間単位でしか勉強できません。)
> ただしテストはすべて$X$点満点なので、$X$より大きい点数にすることはできません。
>
> ##### 制約
> - $1 \leq N \leq 10^5$
> - $1 \leq X \leq 10^5$
> - $0 \leq b\_i \leq X \  (i \leq i \leq N)$
> - $1 \leq l\_i \leq u\_i \leq 10^5 \  (i \leq i \leq N)$
>
> <cite>[AGC034 C - Tests](https://atcoder.jp/contests/agc034/tasks/agc034_c)</cite>

まず、高橋君はほぼすべての問題に対し、満点をとるまで勉強するか、まったく勉強しないかのどちらかで良いと気づきました。
正確には、**中途半端に勉強するものは高々1つ**、ということです。

次に、どうにかして、**各テストに優先順位をつけたい**とおもいます。
勉強する優先順位がつけられれば、後は何点分勉強すればよいかという問題だけになるからです。

優先順位は、そのテストを勉強した際、どれくらい勝負に寄与するかを考えると良さそうです。
ノー勉の状態を基準に考えてみましょう。

まず、あるテスト$i$を満点まで勉強したときの寄与はどれくらいになるでしょうか。
点数が青木くんに勝っているとき、重要度は最大の$u\_i$にするのがお得です。
このとき、$u\_i\times(X-b\_i)$のアドバンテージを得るでしょう。

今はノー勉の状態を基準に考えているので、基準値からの寄与を考えます。
このとき、重要度は最小の$l\_i$にするのが良いです。
ノー勉の場合、$l\_i\times b\_i$のディスアドバンテージがある状態です。

よって、**あるテスト$i$を満点まで勉強したときの寄与$D\_i$**は、
$$D\_i=u\_i\times(X-b\_i)+l\_i\times b\_i$$
と計算できます。

この寄与$D\_i$が大きいものから、順に勉強してゆくのが良さそうです。
すべてのテストについて$D\_i$を計算し、降順にソートすれば扱いやすそうです。
（$D\_i$が等しいテストの比較はについては後述します。）

ここまでの計算量は、$N$個のテストについて$O(1)$で$D\_i$を計算、$O(N\log N)$でソートするので、$O(N+N\log N)$、つまり$O(N\log N)$です。

---

それでは、この寄与$D\_i$の降順に、何点分のテスト勉強をすれば良いのでしょう。
僕はこの部分に悩まされ、問題Cを解くことができませんでした。

模範解答では、**二分探索**を用います。

簡単な話でした。
$k$点分勉強するとき、$k$が増えると$D\_i$の和も増えてゆきます。
そして、寄与の和が$\sum\_{i=1}^{N} l\_i b\_i$を超えるような最小の$k$が答えです。
これは線形計画問題で、直接答えを求めることは難しいですが、ある$k$における寄与の和は直接出せそうなので、二分探索が良いです。

（ある$k$における結果が漸化式のように表されるときには、動的計画法などを用います。また、重要度$c\_i$が$u\_i$または$l\_i$と極値を取ることは、線型計画問題の性質からも言えます。）

さて、**ある$k$を決めて、$k$点分勉強する**としましょう。
このとき、青木くんに勝てるか否かが判断できれば、$k$について二分探索を実行できます。

するとまずは、**寄与$D\_i$の降順に並べたテストのうち、前から$\lfloor \frac{k}{X} \rfloor$個は満点まで勉強すれば良い**とわかります。
そして残りの$k\%X$点分を、残りのどれか1つのテストについて勉強します。

ここで注意が必要です。
残りの$k\%X$点分勉強するテストは、寄与$D\_i$降順テストの$\lfloor \frac{k}{X} \rfloor+1$個目とは限りません。
寄与$D\_i$は、あるテスト$i$を満点まで勉強したという仮定での結果です。
中途半端に勉強するテストの寄与は$D\_i$ではありませんし、テストごとの大小関係も変わってきます。

**最後にどのテストを選ぶかは、残りのテストについて全探索する必要があります。**
あるテスト$i$を$k\%X$点だけ勉強するとき、$k\%X < b\_i$ならその寄与は
$$l\_i\times(k\%X)$$
となります。
$k\%X \geq b\_i$ならその寄与は
$$u\_i\times((k\%X)-b\_i)+l\_i\times b\_i$$
となります。
この寄与が一番大きかったテストについて、勉強すれば最善です。

こうして、$k$点分勉強したときの寄与がすべて計算できました。
その**合計が$\sum\_{i=1}^{N} l\_i b\_i$を超える最小の$k$を二分探索で探せば、答えの$k$が見つかります。**

$k$を決めたときの寄与は、計算量$O(N)$で計算できます。
また、$k$の範囲は$0$から$NX$の間なので、二分探索の計算量は$O(N\log NX)$となります。

前半のソートと合わせても、この解法の計算量は$O(N\log NX)$となります。
